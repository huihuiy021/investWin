# æŠ•èµ„èµ„äº§åˆ†æè·Ÿè¸ªå¹³å°è®¾è®¡æ–¹æ¡ˆ

## é¡¹ç›®æ¦‚è¿°
ä¸€ä¸ªåŸºäº **React + Python + PostgreSQL** çš„æŠ•èµ„èµ„äº§åˆ†æè·Ÿè¸ªå¹³å°ï¼Œé‡‡ç”¨**å¾®æœåŠ¡æ¶æ„**ï¼Œä¸“æ³¨äºæŠ•èµ„æœºä¼šæŒ–æ˜å’Œé£é™©æ§åˆ¶ã€‚

## æ¶æ„è®¾è®¡ç†å¿µ

### ğŸ—ï¸ **å¾®æœåŠ¡åˆ†ç¦»æ¶æ„**
é‡‡ç”¨ **Web æœåŠ¡ + ä¸šåŠ¡æœåŠ¡** åˆ†ç¦»è®¾è®¡ï¼Œå®ç°èŒè´£æ¸…æ™°ã€ç‹¬ç«‹æ‰©å±•ã€é«˜å¯ç»´æŠ¤æ€§çš„ç³»ç»Ÿæ¶æ„ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend       â”‚    â”‚  Web Service     â”‚    â”‚ Business Service â”‚
â”‚   (React)        â”‚â”€â”€â”€â–¶â”‚  (FastAPI)       â”‚â”€â”€â”€â–¶â”‚  (Python)        â”‚
â”‚                 â”‚    â”‚  Port: 8000      â”‚    â”‚  Port: 8001      â”‚
â”‚ â€¢ ç”¨æˆ·ç•Œé¢       â”‚    â”‚ â€¢ HTTP API       â”‚    â”‚ â€¢ ä¸šåŠ¡é€»è¾‘       â”‚
â”‚ â€¢ æ•°æ®å±•ç¤º       â”‚    â”‚ â€¢ ç”¨æˆ·è®¤è¯       â”‚    â”‚ â€¢ æŠ•èµ„åˆ†æ       â”‚
â”‚ â€¢ äº¤äº’æ“ä½œ       â”‚    â”‚ â€¢ è¯·æ±‚è·¯ç”±       â”‚    â”‚ â€¢ é£é™©è®¡ç®—       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚                       â”‚
                                â–¼                       â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   PostgreSQL     â”‚    â”‚   Redis Cache    â”‚
                       â”‚   Database       â”‚    â”‚                 â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### âœ… **èµ„äº§åˆ†æè·Ÿè¸ªæ¨¡å—**
- å¤šèµ„äº§ç±»å‹æ”¯æŒï¼ˆè‚¡ç¥¨ã€æœŸæƒã€æœŸè´§ï¼‰
- å®æ—¶ä»·æ ¼è·Ÿè¸ªå’Œå†å²æ•°æ®å±•ç¤º
- æŠ€æœ¯æŒ‡æ ‡è‡ªåŠ¨è®¡ç®—ï¼ˆMAã€RSIã€MACDç­‰ï¼‰
- èµ„äº§æ”¶ç›Šç‡å’Œè¶‹åŠ¿åˆ†æ

### âœ… **æŠ•èµ„æœºä¼šæŒ–æ˜æ¨¡å—**
- **æŠ€æœ¯é¢æœºä¼š**ï¼šçªç ´è¯†åˆ«ã€è¶…ä¹°è¶…å–æ£€æµ‹ã€å½¢æ€è¯†åˆ«
- **èµ„é‡‘æµæœºä¼š**ï¼šæˆäº¤é‡å¼‚å¸¸ã€å¤§å•æµå…¥ã€æœºæ„åŠ¨å‘åˆ†æ
- **è¡ç”Ÿå“æœºä¼š**ï¼šæœŸæƒæ³¢åŠ¨ç‡äº¤æ˜“ã€å¥—åˆ©æœºä¼šè¯†åˆ«
- **æ™ºèƒ½ç®—æ³•å¼•æ“**ï¼šå¤šç»´åº¦æœºä¼šè¯†åˆ«å’Œç½®ä¿¡åº¦è¯„åˆ†

### âœ… **é£é™©æ§åˆ¶æ¨¡å—**
- **ä¸ªè‚¡é£é™©è¯„ä¼°**ï¼šVaRè®¡ç®—ã€æœ€å¤§å›æ’¤ã€æ³¢åŠ¨ç‡åˆ†æ
- **ç»„åˆé£é™©ç›‘æ§**ï¼šç›¸å…³æ€§åˆ†æã€é›†ä¸­åº¦é£é™©ã€åˆ†æ•£åº¦è¯„ä¼°
- **å®æ—¶é¢„è­¦ç³»ç»Ÿ**ï¼šä»·æ ¼ä¸‹è·Œã€æ³¢åŠ¨ç‡æ¿€å¢ã€å¼‚å¸¸äº¤æ˜“ç›‘æ§
- **å‹åŠ›æµ‹è¯•**ï¼šå¤šç§æƒ…æ™¯åˆ†æå’Œé£é™©è¯„ä¼°

## æŠ€æœ¯æ¶æ„

### **ğŸŒ å‰ç«¯å±‚ (React + TypeScript)**
- **UIæ¡†æ¶**ï¼šAnt Designï¼ˆä¸“ä¸šç»„ä»¶åº“ï¼‰
- **çŠ¶æ€ç®¡ç†**ï¼šRedux Toolkitï¼ˆå¯é¢„æµ‹çŠ¶æ€ç®¡ç†ï¼‰
- **æ•°æ®å¯è§†åŒ–**ï¼šChart.js/Rechartsï¼ˆäº¤äº’å¼å›¾è¡¨ï¼‰
- **HTTPå®¢æˆ·ç«¯**ï¼šAxiosï¼ˆAPIè¯·æ±‚ï¼‰
- **å®æ—¶é€šä¿¡**ï¼šWebSocketï¼ˆå®æ—¶æ•°æ®æ›´æ–°ï¼‰

### **ğŸ”Œ Web æœåŠ¡å±‚ (FastAPI - Port: 8000)**
- **æ¡†æ¶é€‰æ‹©**ï¼šFastAPIï¼ˆé«˜æ€§èƒ½ã€è‡ªåŠ¨APIæ–‡æ¡£ï¼‰
- **æ ¸å¿ƒèŒè´£**ï¼š
  - HTTP API æ¥å£å¤„ç†
  - ç”¨æˆ·è®¤è¯å’Œæˆæƒï¼ˆJWTï¼‰
  - è¯·æ±‚å‚æ•°éªŒè¯
  - å“åº”æ ¼å¼åŒ–
  - ä¸å‰ç«¯é€šä¿¡
  - è°ƒç”¨ä¸šåŠ¡æœåŠ¡
- **æ ¸å¿ƒåº“**ï¼šSQLAlchemyï¼ˆORMï¼‰ã€Pydanticï¼ˆæ•°æ®éªŒè¯ï¼‰ã€httpxï¼ˆæœåŠ¡é—´é€šä¿¡ï¼‰

### **âš™ï¸ ä¸šåŠ¡æœåŠ¡å±‚ (Python - Port: 8001)**
- **æ¡†æ¶é€‰æ‹©**ï¼šFastAPIï¼ˆè½»é‡çº§APIï¼‰
- **æ ¸å¿ƒèŒè´£**ï¼š
  - æŠ•èµ„æœºä¼šæŒ–æ˜ç®—æ³•
  - æŠ€æœ¯æŒ‡æ ‡è®¡ç®—ï¼ˆMAã€RSIã€MACDç­‰ï¼‰
  - é£é™©è¯„ä¼°æ¨¡å‹ï¼ˆVaRã€æœ€å¤§å›æ’¤ã€æ³¢åŠ¨ç‡ï¼‰
  - æŠ•èµ„ç»„åˆä¼˜åŒ–
  - æ•°æ®åˆ†æå’Œå¤„ç†
- **æ ¸å¿ƒåº“**ï¼špandas/numpyï¼ˆæ•°æ®å¤„ç†ï¼‰ã€yfinanceï¼ˆæ•°æ®è·å–ï¼‰ã€TA-Libï¼ˆæŠ€æœ¯æŒ‡æ ‡ï¼‰

### **ğŸ—„ï¸ æ•°æ®å­˜å‚¨å±‚**
#### **PostgreSQL (ä¸»æ•°æ®åº“)**
- **ç”¨æˆ·æ•°æ®**ï¼šè´¦æˆ·ä¿¡æ¯ã€åå¥½è®¾ç½®
- **æŠ•èµ„æ•°æ®**ï¼šèµ„äº§ä¿¡æ¯ã€äº¤æ˜“è®°å½•ã€æŒä»“æ•°æ®
- **åˆ†æç»“æœ**ï¼šé£é™©è¯„ä¼°ã€æœºä¼šæŒ–æ˜ç»“æœ
- **ä¼˜åŠ¿åˆ©ç”¨**ï¼šJSONBå­˜å‚¨å¤æ‚æ•°æ®ã€æ—¶é—´åºåˆ—ä¼˜åŒ–ã€çª—å£å‡½æ•°

#### **Redis (ç¼“å­˜å±‚)**
- **å®æ—¶æ•°æ®ç¼“å­˜**ï¼šè‚¡ç¥¨ä»·æ ¼ã€æŠ€æœ¯æŒ‡æ ‡
- **è®¡ç®—ç»“æœç¼“å­˜**ï¼šåˆ†æç»“æœã€é£é™©è¯„ä¼°
- **ä¼šè¯ç®¡ç†**ï¼šç”¨æˆ·è®¤è¯ä¿¡æ¯
- **ä»»åŠ¡é˜Ÿåˆ—**ï¼šå¼‚æ­¥åˆ†æä»»åŠ¡

### **ğŸ“¡ æœåŠ¡é—´é€šä¿¡**
- **åŒæ­¥é€šä¿¡**ï¼šHTTP REST APIï¼ˆWeb â†’ Businessï¼‰
- **å¼‚æ­¥é€šä¿¡**ï¼šRedis Pub/Subï¼ˆäº‹ä»¶é©±åŠ¨ï¼‰
- **æ•°æ®æ ¼å¼**ï¼šJSONï¼ˆæ ‡å‡†åŒ–çš„æ•°æ®äº¤æ¢æ ¼å¼ï¼‰

## æ•°æ®åº“è®¾è®¡

### 1. **æ ¸å¿ƒæ•°æ®è¡¨è®¾è®¡**

#### ç”¨æˆ·ç³»ç»Ÿ
```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    risk_profile VARCHAR(20) DEFAULT 'moderate', -- conservative, moderate, aggressive
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- ç”¨æˆ·æŠ•èµ„åå¥½
CREATE TABLE user_preferences (
    user_id INTEGER REFERENCES users(id),
    preferred_sectors TEXT[], -- å…³æ³¨çš„è¡Œä¸šæ¿å—
    max_portfolio_size INTEGER DEFAULT 50,
    alert_enabled BOOLEAN DEFAULT true,
    risk_tolerance_level NUMERIC(3,2) CHECK (risk_tolerance_level BETWEEN 0 AND 1)
);
```

#### é‡‘èå·¥å…·æ•°æ®
```sql
-- è‚¡ç¥¨åŸºç¡€ä¿¡æ¯
CREATE TABLE stocks (
    symbol VARCHAR(10) PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    sector VARCHAR(50),
    industry VARCHAR(100),
    market_cap BIGINT,
    exchange VARCHAR(10),
    country VARCHAR(3),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- æœŸæƒé“¾æ•°æ®
CREATE TABLE options_chain (
    id SERIAL PRIMARY KEY,
    symbol VARCHAR(10) REFERENCES stocks(symbol),
    expiration DATE NOT NULL,
    strike NUMERIC(10,2) NOT NULL,
    option_type VARCHAR(4) CHECK (option_type IN ('call', 'put')),
    implied_volatility NUMERIC(8,4),
    greeks JSONB, -- {"delta": 0.5, "gamma": 0.1, "theta": -0.05, "vega": 0.2}
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE(symbol, expiration, strike, option_type)
);

-- æœŸè´§åˆçº¦
CREATE TABLE futures (
    symbol VARCHAR(20) PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    exchange VARCHAR(20),
    contract_size INTEGER,
    tick_value NUMERIC(10,4),
    margin_requirement NUMERIC(10,2)
);
```

#### ä»·æ ¼æ•°æ®ï¼ˆæ—¶é—´åºåˆ—ï¼‰
```sql
-- è‚¡ç¥¨ä»·æ ¼æ•°æ®ï¼ˆåˆ†åŒºè¡¨ï¼‰
CREATE TABLE stock_prices (
    symbol VARCHAR(10) REFERENCES stocks(symbol),
    date DATE NOT NULL,
    open_price NUMERIC(12,4),
    high_price NUMERIC(12,4),
    low_price NUMERIC(12,4),
    close_price NUMERIC(12,4),
    volume BIGINT,
    adj_close NUMERIC(12,4),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    PRIMARY KEY (symbol, date)
) PARTITION BY RANGE (date);

-- æŠ€æœ¯æŒ‡æ ‡ï¼ˆä½¿ç”¨JSONBå­˜å‚¨å¤šä¸ªæŒ‡æ ‡ï¼‰
CREATE TABLE technical_indicators (
    symbol VARCHAR(10) REFERENCES stocks(symbol),
    date DATE NOT NULL,
    indicators JSONB, -- {"ma20": 150.25, "rsi": 65.5, "macd": 2.1}
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    PRIMARY KEY (symbol, date)
);
```

#### æŠ•èµ„ç»„åˆç®¡ç†
```sql
-- æŠ•èµ„ç»„åˆ
CREATE TABLE portfolios (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    name VARCHAR(100) NOT NULL,
    description TEXT,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- æŒä»“æ˜ç»†
CREATE TABLE portfolio_positions (
    id SERIAL PRIMARY KEY,
    portfolio_id INTEGER REFERENCES portfolios(id),
    asset_type VARCHAR(10) CHECK (asset_type IN ('stock', 'option', 'future')),
    symbol VARCHAR(20) NOT NULL,
    quantity NUMERIC(15,4),
    avg_cost NUMERIC(12,4),
    current_price NUMERIC(12,4),
    market_value NUMERIC(15,2),
    unrealized_pnl NUMERIC(15,2),
    position_date DATE NOT NULL,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- äº¤æ˜“è®°å½•
CREATE TABLE transactions (
    id SERIAL PRIMARY KEY,
    portfolio_id INTEGER REFERENCES portfolios(id),
    asset_type VARCHAR(10) CHECK (asset_type IN ('stock', 'option', 'future')),
    symbol VARCHAR(20) NOT NULL,
    action VARCHAR(4) CHECK (action IN ('buy', 'sell')),
    quantity NUMERIC(15,4),
    price NUMERIC(12,4),
    commission NUMERIC(8,2) DEFAULT 0,
    transaction_date TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    notes TEXT
);
```

#### ç­–ç•¥å’Œå›æµ‹
```sql
-- æŠ•èµ„ç­–ç•¥
CREATE TABLE strategies (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    name VARCHAR(100) NOT NULL,
    description TEXT,
    strategy_config JSONB, -- ç­–ç•¥å‚æ•°é…ç½®
    is_public BOOLEAN DEFAULT false,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- å›æµ‹ç»“æœ
CREATE TABLE backtest_results (
    id SERIAL PRIMARY KEY,
    strategy_id INTEGER REFERENCES strategies(id),
    start_date DATE NOT NULL,
    end_date DATE NOT NULL,
    initial_capital NUMERIC(15,2),
    final_value NUMERIC(15,2),
    total_return NUMERIC(8,4),
    sharpe_ratio NUMERIC(6,3),
    max_drawdown NUMERIC(6,3),
    win_rate NUMERIC(5,4),
    results_data JSONB, -- è¯¦ç»†å›æµ‹æ•°æ®
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

## æŠ•èµ„æœºä¼šæŒ–æ˜ç®—æ³•è®¾è®¡

### 1. **æŠ€æœ¯é¢æœºä¼šè¯†åˆ«ç®—æ³•**
```python
# çªç ´æœºä¼šè¯†åˆ«
def detect_breakout_opportunities(stock_data):
    """
    è¯†åˆ«ä»·æ ¼çªç ´æœºä¼š
    - é˜»åŠ›ä½çªç ´
    - æ”¯æ’‘ä½åå¼¹
    - æ•´ç†å½¢æ€çªç ´
    """
    opportunities = []

    # è®¡ç®—å…³é”®ä»·ä½
    resistance_levels = calculate_resistance_levels(stock_data)
    support_levels = calculate_support_levels(stock_data)

    # çªç ´æ£€æµ‹é€»è¾‘
    current_price = stock_data[-1]['close']
    volume = stock_data[-1]['volume']
    avg_volume = calculate_avg_volume(stock_data, 20)

    # é˜»åŠ›ä½çªç ´
    for level in resistance_levels:
        if current_price > level and volume > avg_volume * 1.5:
            opportunities.append({
                'type': 'resistance_breakout',
                'price_level': level,
                'confidence': calculate_breakout_confidence(stock_data, level)
            })

    return opportunities

# è¶…ä¹°è¶…å–æœºä¼š
def detect_oversold_overbought_opportunities(stock_data):
    """
    åŸºäºRSIã€å¸ƒæ—å¸¦ç­‰æŒ‡æ ‡è¯†åˆ«è¶…ä¹°è¶…å–æœºä¼š
    """
    rsi = calculate_rsi(stock_data, 14)
    bollinger_bands = calculate_bollinger_bands(stock_data, 20, 2)

    opportunities = []
    current_price = stock_data[-1]['close']

    # è¶…å–åå¼¹æœºä¼š
    if rsi < 30 and current_price <= bollinger_bands['lower_band']:
        opportunities.append({
            'type': 'oversold_bounce',
            'rsi': rsi,
            'price_position': 'below_lower_band',
            'potential_upside': calculate_potential_upside(stock_data)
        })

    return opportunities
```

### 2. **èµ„é‡‘æµæœºä¼šè¯†åˆ«ç®—æ³•**
```python
def detect_volume_anomalies(stock_data):
    """
    è¯†åˆ«æˆäº¤é‡å¼‚å¸¸æœºä¼š
    """
    opportunities = []

    # è®¡ç®—æˆäº¤é‡åŸºå‡†
    avg_volume_5d = calculate_avg_volume(stock_data, 5)
    avg_volume_20d = calculate_avg_volume(stock_data, 20)
    current_volume = stock_data[-1]['volume']

    # æ”¾é‡æ£€æµ‹
    volume_ratio = current_volume / avg_volume_20d
    price_change = (stock_data[-1]['close'] - stock_data[-2]['close']) / stock_data[-2]['close']

    if volume_ratio > 3 and price_change > 0.05:  # æ”¾é‡ä¸Šæ¶¨
        opportunities.append({
            'type': 'volume_surge_up',
            'volume_ratio': volume_ratio,
            'price_change': price_change,
            'strength': 'strong' if volume_ratio > 5 else 'moderate'
        })

    return opportunities

def detect_institutional_flow(trade_data):
    """
    è¯†åˆ«æœºæ„èµ„é‡‘æµå‘
    """
    # åŸºäºå¤§å•äº¤æ˜“æ•°æ®åˆ†ææœºæ„åŠ¨å‘
    large_trades = filter_large_trades(trade_data, min_size=1000000)

    if len(large_trades) > 0:
        net_flow = calculate_net_flow(large_trades)
        return {
            'type': 'institutional_flow',
            'net_flow': net_flow,
            'trade_count': len(large_trades),
            'sentiment': 'bullish' if net_flow > 0 else 'bearish'
        }
```

### 3. **æœŸæƒæœºä¼šæŒ–æ˜ç®—æ³•**
```python
def detect_option_volatility_opportunities(option_chain):
    """
    è¯†åˆ«æœŸæƒæ³¢åŠ¨ç‡äº¤æ˜“æœºä¼š
    """
    opportunities = []

    # è®¡ç®—éšå«æ³¢åŠ¨ç‡åæ–œ
    iv_skew = calculate_iv_skew(option_chain)

    # æ³¢åŠ¨ç‡ä½ä¼°/é«˜ä¼°æœºä¼š
    historical_vol = calculate_historical_volatility(underlying_stock, 30)
    avg_iv = calculate_average_iv(option_chain)

    if avg_iv < historical_vol * 0.8:  # éšå«æ³¢åŠ¨ç‡ä½ä¼°
        opportunities.append({
            'type': 'iv_undervalued',
            'strategy': 'long_straddle' if iv_skew < 0 else 'long_calendar',
            'iv_ratio': avg_iv / historical_vol
        })

    return opportunities

def detect_option_flow_anomalies(option_trades):
    """
    è¯†åˆ«æœŸæƒå¼‚åŠ¨äº¤æ˜“
    """
    # ç›‘æ§å¼‚å¸¸å¤§é¢æœŸæƒäº¤æ˜“
    unusual_trades = detect_unusual_option_activity(option_trades)

    for trade in unusual_trades:
        opportunities.append({
            'type': 'option_flow_anomaly',
            'trade_details': trade,
            'sentiment_implication': analyze_option_sentiment(trade),
            'confidence_score': calculate_flow_confidence(trade)
        })
```

## é£é™©æ§åˆ¶æœºåˆ¶è®¾è®¡

### 1. **å¤šå±‚é£é™©ç›‘æ§ä½“ç³»**

```python
# ä¸ªè‚¡é£é™©è¯„ä¼°
class IndividualStockRisk:
    def calculate_var(self, price_data, confidence_level=0.95, holding_period=1):
        """
        è®¡ç®—VaR (Value at Risk) - åœ¨é™©ä»·å€¼
        """
        returns = calculate_daily_returns(price_data)
        var_percentile = (1 - confidence_level) * 100

        var_value = np.percentile(returns, var_percentile) * holding_period
        return {
            'var_95': var_value,
            'var_99': np.percentile(returns, 1) * holding_period,
            'interpretation': f'æœªæ¥{holding_period}å¤©æœ‰{confidence_level*100}%æ¦‚ç‡æŸå¤±ä¸è¶…è¿‡{abs(var_value):.2%}'
        }

    def calculate_max_drawdown(self, price_data):
        """
        è®¡ç®—æœ€å¤§å›æ’¤
        """
        peak = price_data['close'].expanding().max()
        drawdown = (price_data['close'] - peak) / peak
        max_dd = drawdown.min()

        return {
            'max_drawdown': max_dd,
            'max_dd_duration': calculate_drawdown_duration(drawdown),
            'current_drawdown': drawdown.iloc[-1]
        }

    def calculate_volatility_risk(self, price_data, window=20):
        """
        è®¡ç®—æ³¢åŠ¨ç‡é£é™©
        """
        returns = calculate_daily_returns(price_data)
        rolling_vol = returns.rolling(window=window).std() * np.sqrt(252)

        current_vol = rolling_vol.iloc[-1]
        vol_percentile = rolling_vol.quantile([0.25, 0.5, 0.75])

        return {
            'current_volatility': current_vol,
            'volatility_level': self.classify_volatility_level(current_vol, vol_percentile),
            'volatility_trend': 'increasing' if rolling_vol.iloc[-1] > rolling_vol.iloc[-5] else 'decreasing'
        }
```

### 2. **æŠ•èµ„ç»„åˆé£é™©æ§åˆ¶**

```python
# ç»„åˆé£é™©åˆ†æ•£åº¦åˆ†æ
class PortfolioRiskManager:
    def calculate_correlation_matrix(self, portfolio_positions):
        """
        è®¡ç®—æŒä»“ç›¸å…³æ€§çŸ©é˜µ
        """
        returns_data = {}
        for position in portfolio_positions:
            returns_data[position['symbol']] = get_historical_returns(position['symbol'])

        correlation_matrix = pd.DataFrame(returns_data).corr()
        return correlation_matrix

    def calculate_concentration_risk(self, portfolio_positions):
        """
        è®¡ç®—é›†ä¸­åº¦é£é™©
        """
        total_value = sum(pos['market_value'] for pos in portfolio_positions)

        # æŒ‰è‚¡ç¥¨è®¡ç®—é›†ä¸­åº¦
        stock_concentration = {}
        for pos in portfolio_positions:
            weight = pos['market_value'] / total_value
            stock_concentration[pos['symbol']] = weight

        # è®¡ç®—HerfindahlæŒ‡æ•°
        hhi = sum(weight**2 for weight in stock_concentration.values())

        return {
            'concentration_risk': 'high' if hhi > 0.25 else 'medium' if hhi > 0.15 else 'low',
            'herfindahl_index': hhi,
            'top_position_weight': max(stock_concentration.values()),
            'diversification_score': 1 - hhi
        }

    def generate_portfolio_rebalancing_suggestions(self, portfolio_positions):
        """
        ç”Ÿæˆç»„åˆå†å¹³è¡¡å»ºè®®
        """
        current_weights = self.calculate_current_weights(portfolio_positions)
        target_weights = self.get_optimal_weights(portfolio_positions)

        suggestions = []
        for symbol in current_weights:
            current_weight = current_weights[symbol]
            target_weight = target_weights.get(symbol, 0)

            if abs(current_weight - target_weight) > 0.05:  # 5%é˜ˆå€¼
                action = 'reduce' if current_weight > target_weight else 'increase'
                suggestions.append({
                    'symbol': symbol,
                    'action': action,
                    'current_weight': current_weight,
                    'target_weight': target_weight,
                    'adjustment_amount': abs(current_weight - target_weight)
                })

        return suggestions
```

### 3. **å®æ—¶é£é™©é¢„è­¦ç³»ç»Ÿ**

```python
class RiskAlertSystem:
    def __init__(self):
        self.alert_rules = self.load_default_rules()

    def load_default_rules(self):
        return {
            'price_drop_alert': {
                'threshold': -0.15,  # 15%ä¸‹è·Œ
                'timeframe': 'daily',
                'priority': 'high'
            },
            'volatility_spike': {
                'threshold': 3.0,  # æ³¢åŠ¨ç‡è¶…è¿‡3å€
                'baseline_window': 20,
                'priority': 'medium'
            },
            'volume_anomaly': {
                'threshold': 5.0,  # æˆäº¤é‡å¼‚å¸¸5å€
                'priority': 'medium'
            },
            'correlation_increase': {
                'threshold': 0.8,  # ç›¸å…³æ€§è¶…è¿‡80%
                'priority': 'low'
            }
        }

    def check_risk_alerts(self, asset_data, portfolio_data):
        """
        æ£€æŸ¥é£é™©é¢„è­¦æ¡ä»¶
        """
        alerts = []

        # ä»·æ ¼ä¸‹è·Œé¢„è­¦
        price_change = self.calculate_price_change(asset_data)
        if price_change <= self.alert_rules['price_drop_alert']['threshold']:
            alerts.append({
                'type': 'price_drop',
                'severity': 'high',
                'message': f'èµ„äº§ä»·æ ¼ä¸‹è·Œ {abs(price_change):.2%}',
                'suggestion': 'è€ƒè™‘å‡ä»“æˆ–è®¾ç½®æ­¢æŸ'
            })

        # æ³¢åŠ¨ç‡æ¿€å¢é¢„è­¦
        current_vol = self.calculate_current_volatility(asset_data)
        avg_vol = self.calculate_average_volatility(asset_data, 20)
        if current_vol > avg_vol * self.alert_rules['volatility_spike']['threshold']:
            alerts.append({
                'type': 'volatility_spike',
                'severity': 'medium',
                'message': f'æ³¢åŠ¨ç‡æ¿€å¢è‡³æ­£å¸¸æ°´å¹³çš„ {current_vol/avg_vol:.1f} å€',
                'suggestion': 'æ³¨æ„ä»“ä½æ§åˆ¶ï¼Œè€ƒè™‘å¯¹å†²ç­–ç•¥'
            })

        return alerts

    def generate_risk_report(self, portfolio_data):
        """
        ç”Ÿæˆé£é™©è¯„ä¼°æŠ¥å‘Š
        """
        report = {
            'overall_risk_score': self.calculate_overall_risk_score(portfolio_data),
            'key_risks': self.identify_key_risks(portfolio_data),
            'recommendations': self.generate_risk_recommendations(portfolio_data),
            'stress_test_results': self.run_stress_tests(portfolio_data)
        }

        return report
```

### 4. **å‹åŠ›æµ‹è¯•ç³»ç»Ÿ**

```python
def run_stress_scenarios(portfolio_positions):
    """
    è¿è¡Œå‹åŠ›æµ‹è¯•æƒ…æ™¯
    """
    scenarios = {
        'market_crash': {'market_decline': -0.30, 'volatility_spike': 2.5},
        'sector_rotation': {'tech_decline': -0.20, 'financial_gain': 0.10},
        'interest_rate_shock': {'rate_increase': 0.02, 'bond_impact': -0.15},
        'liquidity_crisis': {'volume_decline': -0.50, 'spread_widening': 0.02}
    }

    results = {}
    for scenario_name, parameters in scenarios.items():
        scenario_loss = calculate_scenario_impact(portfolio_positions, parameters)
        results[scenario_name] = {
            'potential_loss': scenario_loss,
            'loss_percentage': scenario_loss / calculate_portfolio_value(portfolio_positions),
            'worst_affected_positions': identify_worst_positions(portfolio_positions, parameters)
        }

    return results
```

## ç³»ç»Ÿæ¶æ„å’ŒAPIæ¥å£è®¾è®¡

### 1. **åç«¯APIæ¥å£è®¾è®¡ (FastAPI)**

```python
# app/api/assets.py - èµ„äº§ç®¡ç†API
from fastapi import APIRouter, Depends, HTTPException
from typing import List, Optional

router = APIRouter(prefix="/api/assets", tags=["assets"])

@router.get("/", response_model=List[AssetResponse])
async def get_assets(
    skip: int = 0,
    limit: int = 50,
    asset_type: Optional[str] = None,
    current_user: User = Depends(get_current_user)
):
    """è·å–ç”¨æˆ·èµ„äº§åˆ—è¡¨"""
    pass

@router.post("/", response_model=AssetResponse)
async def add_asset(
    asset: AssetCreate,
    current_user: User = Depends(get_current_user)
):
    """æ·»åŠ æ–°èµ„äº§åˆ°è·Ÿè¸ªåˆ—è¡¨"""
    pass

@router.get("/{symbol}/analysis")
async def get_asset_analysis(
    symbol: str,
    timeframe: str = "daily",
    current_user: User = Depends(get_current_user)
):
    """è·å–èµ„äº§åˆ†æç»“æœ"""
    pass

@router.get("/{symbol}/realtime")
async def get_realtime_data(symbol: str):
    """è·å–å®æ—¶ä»·æ ¼æ•°æ®"""
    pass
```

```python
# app/api/opportunities.py - æœºä¼šæŒ–æ˜API
@router.get("/api/opportunities", response_model=List[OpportunityResponse])
async def get_investment_opportunities(
    opportunity_type: Optional[str] = None,
    min_confidence: float = 0.6,
    current_user: User = Depends(get_current_user)
):
    """è·å–æŠ•èµ„æœºä¼šåˆ—è¡¨"""
    pass

@router.get("/api/opportunities/scan")
async def scan_market_opportunities():
    """æ‰«æå¸‚åœºæœºä¼šï¼ˆå®šæ—¶ä»»åŠ¡è§¦å‘ï¼‰"""
    pass

@router.post("/api/opportunities/{id}/track")
async def track_opportunity(
    id: int,
    track_data: OpportunityTrack,
    current_user: User = Depends(get_current_user)
):
    """è·Ÿè¸ªç‰¹å®šæŠ•èµ„æœºä¼š"""
    pass
```

```python
# app/api/risk.py - é£é™©æ§åˆ¶API
@router.get("/api/risk/portfolio")
async def get_portfolio_risk(
    current_user: User = Depends(get_current_user)
):
    """è·å–æŠ•èµ„ç»„åˆé£é™©è¯„ä¼°"""
    pass

@router.get("/api/risk/alerts")
async def get_risk_alerts(
    current_user: User = Depends(get_current_user)
):
    """è·å–é£é™©é¢„è­¦ä¿¡æ¯"""
    pass

@router.post("/api/risk/stress-test")
async def run_stress_test(
    test_config: StressTestConfig,
    current_user: User = Depends(get_current_user)
):
    """è¿è¡Œå‹åŠ›æµ‹è¯•"""
    pass
```

### 2. **WebSocket å®æ—¶æ•°æ®æ¥å£**

```python
# app/websocket/realtime_data.py
from fastapi import WebSocket, WebSocketDisconnect

class ConnectionManager:
    def __init__(self):
        self.active_connections: List[WebSocket] = []
        self.user_subscriptions: dict = {}

manager = ConnectionManager()

@router.websocket("/ws/realtime/{user_id}")
async def websocket_endpoint(websocket: WebSocket, user_id: int):
    await manager.connect(websocket)
    try:
        while True:
            data = await websocket.receive_text()
            # å¤„ç†è®¢é˜…è¯·æ±‚
            subscription_data = json.loads(data)
            await handle_subscription(websocket, subscription_data)

            # å‘é€å®æ—¶æ•°æ®
            realtime_data = await get_realtime_data(subscription_data.get('symbols'))
            await websocket.send_text(json.dumps(realtime_data))

    except WebSocketDisconnect:
        manager.disconnect(websocket)
```

### 3. **æ•°æ®æœåŠ¡å±‚è®¾è®¡**

```python
# app/services/data_service.py
class MarketDataService:
    def __init__(self):
        self.redis_client = redis.Redis()
        self.data_sources = {
            'yahoo_finance': YahooFinanceClient(),
            'alpha_vantage': AlphaVantageClient(),
            'polygon': PolygonClient()
        }

    async def get_real_time_price(self, symbol: str) -> RealTimePrice:
        """è·å–å®æ—¶ä»·æ ¼"""
        # å…ˆæ£€æŸ¥ç¼“å­˜
        cached_data = self.redis_client.get(f"price:{symbol}")
        if cached_data:
            return json.loads(cached_data)

        # ä»æ•°æ®æºè·å–
        for source_name, source_client in self.data_sources.items():
            try:
                data = await source_client.get_quote(symbol)
                # ç¼“å­˜30ç§’
                self.redis_client.setex(f"price:{symbol}", 30, json.dumps(data))
                return data
            except Exception as e:
                continue

        raise HTTPException(status_code=404, detail=f"Data not found for {symbol}")

class AnalysisService:
    def __init__(self):
        self.indicator_calculator = TechnicalIndicators()
        self.opportunity_detector = OpportunityDetector()

    async def analyze_asset(self, symbol: str, timeframe: str) -> AssetAnalysis:
        """ç»¼åˆåˆ†æèµ„äº§"""
        price_data = await self.get_historical_data(symbol, timeframe)

        # è®¡ç®—æŠ€æœ¯æŒ‡æ ‡
        indicators = self.indicator_calculator.calculate_all(price_data)

        # æŒ–æ˜æŠ•èµ„æœºä¼š
        opportunities = self.opportunity_detector.detect_opportunities(price_data, indicators)

        # é£é™©è¯„ä¼°
        risk_metrics = self.calculate_risk_metrics(price_data)

        return AssetAnalysis(
            symbol=symbol,
            current_price=price_data.iloc[-1]['close'],
            indicators=indicators,
            opportunities=opportunities,
            risk_metrics=risk_metrics,
            updated_at=datetime.now()
        )
```

### 4. **å‰ç«¯çŠ¶æ€ç®¡ç†è®¾è®¡**

```typescript
// src/store/store.ts
import { configureStore } from '@reduxjs/toolkit'
import assetsReducer from './slices/assetsSlice'
import opportunitiesReducer from './slices/opportunitiesSlice'
import riskReducer from './slices/riskSlice'

export const store = configureStore({
  reducer: {
    assets: assetsReducer,
    opportunities: opportunitiesReducer,
    risk: riskReducer,
  },
})

export type RootState = ReturnType<typeof store.getState>
export type AppDispatch = typeof store.dispatch
```

```typescript
// src/store/slices/assetsSlice.ts
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit'

interface Asset {
  symbol: string
  name: string
  currentPrice: number
  change: number
  changePercent: number
  indicators: TechnicalIndicators
  lastUpdate: string
}

export const fetchAssets = createAsyncThunk(
  'assets/fetchAssets',
  async (_, { rejectWithValue }) => {
    try {
      const response = await api.get('/assets/')
      return response.data
    } catch (error) {
      return rejectWithValue(error.response.data)
    }
  }
)

const assetsSlice = createSlice({
  name: 'assets',
  initialState,
  reducers: {
    updateRealTimePrice: (state, action) => {
      const { symbol, price, change } = action.payload
      const asset = state.assets.find(a => a.symbol === symbol)
      if (asset) {
        asset.currentPrice = price
        asset.change = change
        asset.changePercent = (change / (price - change)) * 100
        asset.lastUpdate = new Date().toISOString()
      }
    },
  },
  extraReducers: (builder) => {
    builder.addCase(fetchAssets.fulfilled, (state, action) => {
      state.assets = action.payload
      state.loading = false
    })
  },
})
```

## å‰ç«¯é¡µé¢ç»“æ„è®¾è®¡

### 1. **æ•´ä½“é¡µé¢æ¶æ„**

```
src/pages/
â”œâ”€â”€ Dashboard/
â”‚   â”œâ”€â”€ index.tsx           # æ€»è§ˆä»ªè¡¨æ¿
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ PortfolioSummary.tsx
â”‚   â”‚   â”œâ”€â”€ MarketOverview.tsx
â”‚   â”‚   â”œâ”€â”€ RecentOpportunities.tsx
â”‚   â”‚   â””â”€â”€ RiskAlerts.tsx
â”œâ”€â”€ Assets/
â”‚   â”œâ”€â”€ index.tsx           # èµ„äº§ç®¡ç†é¡µé¢
â”‚   â”œâ”€â”€ AssetDetail.tsx     # èµ„äº§è¯¦æƒ…é¡µé¢
â”‚   â””â”€â”€ components/
â”‚       â”œâ”€â”€ AssetCard.tsx
â”‚       â”œâ”€â”€ AssetTable.tsx
â”‚       â”œâ”€â”€ AddAssetModal.tsx
â”‚       â””â”€â”€ PriceChart.tsx
â”œâ”€â”€ Opportunities/
â”‚   â”œâ”€â”€ index.tsx           # æŠ•èµ„æœºä¼šé¡µé¢
â”‚   â”œâ”€â”€ OpportunityDetail.tsx # æœºä¼šè¯¦æƒ…é¡µé¢
â”‚   â””â”€â”€ components/
â”‚       â”œâ”€â”€ OpportunityCard.tsx
â”‚       â”œâ”€â”€ OpportunityFilters.tsx
â”‚       â””â”€â”€ TechnicalScanner.tsx
â””â”€â”€ RiskAnalysis/
    â”œâ”€â”€ index.tsx           # é£é™©åˆ†æé¡µé¢
    â””â”€â”€ components/
        â”œâ”€â”€ RiskDashboard.tsx
        â”œâ”€â”€ StressTest.tsx
        â””â”€â”€ RiskAlerts.tsx
```

### 2. **æ ¸å¿ƒé¡µé¢ç»„ä»¶è®¾è®¡**

```typescript
// src/pages/Dashboard/index.tsx
import React from 'react'
import { Grid, Card, Row, Col } from 'antd'
import PortfolioSummary from './components/PortfolioSummary'
import MarketOverview from './components/MarketOverview'
import RecentOpportunities from './components/RecentOpportunities'
import RiskAlerts from './components/RiskAlerts'

const Dashboard: React.FC = () => {
  return (
    <div className="dashboard">
      <Row gutter={[16, 16]}>
        <Col span={24}>
          <PortfolioSummary />
        </Col>
      </Row>

      <Row gutter={[16, 16]} style={{ marginTop: 16 }}>
        <Col span={16}>
          <MarketOverview />
        </Col>
        <Col span={8}>
          <RecentOpportunities />
        </Col>
      </Row>

      <Row gutter={[16, 16]} style={{ marginTop: 16 }}>
        <Col span={24}>
          <RiskAlerts />
        </Col>
      </Row>
    </div>
  )
}
```

```typescript
// src/pages/Assets/AssetDetail.tsx
import React, { useState, useEffect } from 'react'
import { useParams } from 'react-router-dom'
import { Card, Tabs, Row, Col, Statistic } from 'antd'
import PriceChart from '../components/PriceChart'
import TechnicalIndicators from '../components/TechnicalIndicators'
import RiskMetrics from '../components/RiskMetrics'
import RelatedOpportunities from '../components/RelatedOpportunities'

const { TabPane } = Tabs

const AssetDetail: React.FC = () => {
  const { symbol } = useParams<{ symbol: string }>()
  const [assetData, setAssetData] = useState<any>(null)

  useEffect(() => {
    // è·å–èµ„äº§è¯¦ç»†æ•°æ®
    fetchAssetDetails(symbol)
  }, [symbol])

  return (
    <div className="asset-detail">
      <Row gutter={[16, 16]}>
        <Col span={24}>
          <Card>
            <Row gutter={16}>
              <Col span={6}>
                <Statistic title="å½“å‰ä»·æ ¼" value={assetData?.currentPrice} />
              </Col>
              <Col span={6}>
                <Statistic
                  title="æ—¥æ¶¨è·Œ"
                  value={assetData?.change}
                  valueStyle={{ color: assetData?.change > 0 ? '#3f8600' : '#cf1322' }}
                />
              </Col>
              <Col span={6}>
                <Statistic title="æˆäº¤é‡" value={assetData?.volume} />
              </Col>
              <Col span={6}>
                <Statistic title="å¸‚å€¼" value={assetData?.marketCap} />
              </Col>
            </Row>
          </Card>
        </Col>
      </Row>

      <Row gutter={[16, 16]} style={{ marginTop: 16 }}>
        <Col span={16}>
          <Card title="ä»·æ ¼èµ°åŠ¿">
            <PriceChart symbol={symbol} />
          </Card>
        </Col>
        <Col span={8}>
          <Card title="æŠ€æœ¯æŒ‡æ ‡">
            <TechnicalIndicators symbol={symbol} />
          </Card>
        </Col>
      </Row>

      <Row style={{ marginTop: 16 }}>
        <Col span={24}>
          <Card title="é£é™©åˆ†æ">
            <RiskMetrics symbol={symbol} />
          </Card>
        </Col>
      </Row>
    </div>
  )
}
```

### 3. **å…³é”®é€šç”¨ç»„ä»¶è®¾è®¡**

```typescript
// src/components/PriceChart.tsx
import React, { useEffect, useRef } from 'react'
import { Line } from 'react-chartjs-2'
import { useWebSocket } from '../hooks/useWebSocket'

interface PriceChartProps {
  symbol: string
  timeframe?: string
  height?: number
}

const PriceChart: React.FC<PriceChartProps> = ({
  symbol,
  timeframe = '1D',
  height = 300
}) => {
  const chartRef = useRef<any>(null)
  const { data: realtimeData } = useWebSocket(`/ws/realtime/${symbol}`)

  const chartData = {
    labels: [], // æ—¶é—´æ ‡ç­¾
    datasets: [
      {
        label: 'ä»·æ ¼',
        data: [], // ä»·æ ¼æ•°æ®
        borderColor: 'rgb(75, 192, 192)',
        backgroundColor: 'rgba(75, 192, 192, 0.2)',
        tension: 0.1
      }
    ]
  }

  useEffect(() => {
    if (realtimeData) {
      updateChartWithRealTimeData(realtimeData)
    }
  }, [realtimeData])

  return (
    <div className="price-chart">
      <Line ref={chartRef} data={chartData} height={height} />
    </div>
  )
}
```

```typescript
// src/components/OpportunityCard.tsx
import React from 'react'
import { Card, Tag, Button, Space } from 'antd'
import { Opportunity } from '../types/opportunity'

interface OpportunityCardProps {
  opportunity: Opportunity
  onTrack?: (opportunity: Opportunity) => void
  onIgnore?: (opportunity: Opportunity) => void
}

const OpportunityCard: React.FC<OpportunityCardProps> = ({
  opportunity,
  onTrack,
  onIgnore
}) => {
  const getOpportunityTypeColor = (type: string) => {
    const colors = {
      'breakout': 'green',
      'oversold': 'blue',
      'volume_surge': 'orange',
      'volatility': 'purple'
    }
    return colors[type] || 'default'
  }

  return (
    <Card
      size="small"
      title={
        <Space>
          <Tag color={getOpportunityTypeColor(opportunity.type)}>
            {opportunity.type}
          </Tag>
          {opportunity.symbol}
        </Space>
      }
      extra={
        <Space>
          <Button size="small" onClick={() => onTrack?.(opportunity)}>
            è·Ÿè¸ª
          </Button>
          <Button size="small" type="text" onClick={() => onIgnore?.(opportunity)}>
            å¿½ç•¥
          </Button>
        </Space>
      }
    >
      <p>{opportunity.description}</p>
      <div className="opportunity-metrics">
        <span>ç½®ä¿¡åº¦: {(opportunity.confidence * 100).toFixed(1)}%</span>
        <span>é¢„æœŸæ”¶ç›Š: {opportunity.expectedReturn?.toFixed(2)}%</span>
        <span>é£é™©ç­‰çº§: {opportunity.riskLevel}</span>
      </div>
    </Card>
  )
}
```

### 4. **è·¯ç”±é…ç½®**

```typescript
// src/App.tsx
import React from 'react'
import { BrowserRouter as Router, Routes, Route } from 'react-router-dom'
import { Layout } from 'antd'
import Dashboard from './pages/Dashboard'
import Assets from './pages/Assets'
import AssetDetail from './pages/Assets/AssetDetail'
import Opportunities from './pages/Opportunities'
import RiskAnalysis from './pages/RiskAnalysis'

const { Content } = Layout

const App: React.FC = () => {
  return (
    <Router>
      <Layout>
        <Content>
          <Routes>
            <Route path="/" element={<Dashboard />} />
            <Route path="/assets" element={<Assets />} />
            <Route path="/assets/:symbol" element={<AssetDetail />} />
            <Route path="/opportunities" element={<Opportunities />} />
            <Route path="/risk" element={<RiskAnalysis />} />
          </Routes>
        </Content>
      </Layout>
    </Router>
  )
}
```

## PostgreSQL ä¼˜åŠ¿åˆ©ç”¨

### çª—å£å‡½æ•°ç¤ºä¾‹
```sql
-- è®¡ç®—ç§»åŠ¨å¹³å‡å’Œæ”¶ç›Šç‡
CREATE VIEW stock_analysis AS
SELECT
    symbol,
    date,
    close_price,
    AVG(close_price) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) as ma20,
    AVG(close_price) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 49 PRECEDING AND CURRENT ROW) as ma50,
    (close_price - LAG(close_price, 1) OVER (PARTITION BY symbol ORDER BY date)) / LAG(close_price, 1) OVER (PARTITION BY symbol ORDER BY date) as daily_return
FROM stock_prices;
```

### JSONB æŸ¥è¯¢ç¤ºä¾‹
```sql
-- æŸ¥è¯¢ç‰¹å®šæŠ€æœ¯æŒ‡æ ‡
SELECT * FROM technical_indicators
WHERE indicators->>'rsi' > '70'
  AND date = CURRENT_DATE;

-- æ›´æ–°æœŸæƒå¸Œè…Šå­—æ¯
UPDATE options_chain
SET greeks = jsonb_set(greeks, '{delta}', '0.65'::jsonb)
WHERE symbol = 'AAPL' AND expiration = '2024-12-20';
```

### ç´¢å¼•ç­–ç•¥
```sql
-- å¤åˆç´¢å¼•
CREATE INDEX idx_stock_prices_symbol_date ON stock_prices(symbol, date DESC);
CREATE INDEX idx_portfolios_user_active ON portfolios(user_id, is_active);

-- JSONB ç´¢å¼•
CREATE INDEX idx_technical_indicators_rsi ON technical_indicators USING GIN ((indicators->'rsi'));
```

## ğŸ“ é¡¹ç›®ç»“æ„

### **å¾®æœåŠ¡ç›®å½•ç»“æ„**
```
investwin/
â”œâ”€â”€ frontend/                 # React å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/     # UIç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ pages/          # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ services/       # APIæœåŠ¡
â”‚   â”‚   â””â”€â”€ store/          # çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ web-service/             # Web APIæœåŠ¡ (Port: 8000)
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/            # APIè·¯ç”±å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/       # è®¤è¯ç›¸å…³
â”‚   â”‚   â”‚   â”œâ”€â”€ assets/     # èµ„äº§ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ portfolios/ # æŠ•èµ„ç»„åˆ
â”‚   â”‚   â”œâ”€â”€ auth/           # è®¤è¯æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ models/         # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ client.py       # ä¸šåŠ¡æœåŠ¡å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ main.py         # WebæœåŠ¡å…¥å£
â”‚   â””â”€â”€ requirements.txt
â”œâ”€â”€ business-service/        # ä¸šåŠ¡é€»è¾‘æœåŠ¡ (Port: 8001)
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ services/       # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ analysis/   # åˆ†ææœåŠ¡
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ technical/  # æŠ€æœ¯åˆ†æ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ fundamental/ # åŸºæœ¬é¢åˆ†æ
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ sentiment/   # æƒ…ç»ªåˆ†æ
â”‚   â”‚   â”‚   â”œâ”€â”€ risk/        # é£é™©è¯„ä¼°
â”‚   â”‚   â”‚   â””â”€â”€ opportunity/ # æœºä¼šæŒ–æ˜
â”‚   â”‚   â”œâ”€â”€ algorithms/     # ç®—æ³•æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ indicators/  # æŠ€æœ¯æŒ‡æ ‡
â”‚   â”‚   â”‚   â”œâ”€â”€ patterns/    # å½¢æ€è¯†åˆ«
â”‚   â”‚   â”‚   â””â”€â”€ optimization/ # ç»„åˆä¼˜åŒ–
â”‚   â”‚   â”œâ”€â”€ models/         # ä¸šåŠ¡æ¨¡å‹
â”‚   â”‚   â””â”€â”€ main.py         # ä¸šåŠ¡æœåŠ¡å…¥å£
â”‚   â””â”€â”€ requirements.txt
â”œâ”€â”€ shared/                   # å…±äº«ä»£ç 
â”‚   â”œâ”€â”€ models/              # å…±äº«æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ utils/               # å…±äº«å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ config/              # é…ç½®æ–‡ä»¶
â””â”€â”€ docker-compose.yml       # å®¹å™¨ç¼–æ’é…ç½®
```

## ğŸ“¡ æœåŠ¡é—´é€šä¿¡

### **é€šä¿¡æ¶æ„**
```mermaid
sequenceDiagram
    participant Frontend
    participant WebService
    participant BusinessService
    participant Database
    participant Cache

    Frontend->>WebService: HTTPè¯·æ±‚ (APIè°ƒç”¨)
    WebService->>WebService: ç”¨æˆ·è®¤è¯/å‚æ•°éªŒè¯
    WebService->>BusinessService: HTTPè°ƒç”¨ (ä¸šåŠ¡é€»è¾‘)
    BusinessService->>Cache: æ£€æŸ¥ç¼“å­˜æ•°æ®
    alt ç¼“å­˜å‘½ä¸­
        Cache-->>BusinessService: è¿”å›ç¼“å­˜æ•°æ®
    else ç¼“å­˜æœªå‘½ä¸­
        BusinessService->>Database: æŸ¥è¯¢/è®¡ç®—æ•°æ®
        Database-->>BusinessService: è¿”å›åŸå§‹æ•°æ®
        BusinessService->>BusinessService: ä¸šåŠ¡é€»è¾‘å¤„ç†
        BusinessService->>Cache: å­˜å‚¨è®¡ç®—ç»“æœ
    end
    BusinessService-->>WebService: è¿”å›ä¸šåŠ¡ç»“æœ
    WebService-->>Frontend: JSONå“åº”
```

### **API è®¾è®¡ç¤ºä¾‹**

#### **Web Service API (é¢å‘å‰ç«¯)**
```python
# web-service/api/opportunities.py
@router.get("/assets/{symbol}/opportunities")
async def get_asset_opportunities(symbol: str, current_user: User = Depends(get_current_user)):
    """è·å–èµ„äº§æŠ•èµ„æœºä¼š"""
    # è°ƒç”¨ä¸šåŠ¡æœåŠ¡
    opportunities = await business_client.get_opportunities(symbol)

    return {
        "symbol": symbol,
        "opportunities": opportunities,
        "user_id": current_user.id,
        "timestamp": datetime.now()
    }
```

#### **Business Service API (å†…éƒ¨æœåŠ¡)**
```python
# business-service/services/opportunity.py
@router.get("/opportunities/{symbol}")
async def analyze_opportunities(symbol: str):
    """åˆ†ææŠ•èµ„æœºä¼šï¼ˆå†…éƒ¨APIï¼‰"""
    # æ£€æŸ¥ç¼“å­˜
    cache_key = f"opportunities:{symbol}"
    cached_result = await cache.get(cache_key)
    if cached_result:
        return cached_result

    # æ‰§è¡Œåˆ†æ
    opportunities = await opportunity_service.find_all_opportunities(symbol)

    # ç¼“å­˜ç»“æœ
    await cache.set(cache_key, opportunities, expire=300)  # 5åˆ†é’Ÿç¼“å­˜

    return opportunities
```

## ğŸ³ éƒ¨ç½²é…ç½®

### **Docker Compose é…ç½®**
```yaml
version: '3.8'
services:
  frontend:
    build: ./frontend
    ports:
      - "3000:3000"
    depends_on:
      - web-service
    environment:
      - REACT_APP_API_URL=http://localhost:8000

  web-service:
    build: ./web-service
    ports:
      - "8000:8000"
    depends_on:
      - business-service
      - postgres
    environment:
      - DATABASE_URL=postgresql://user:password@postgres:5432/investwin
      - BUSINESS_SERVICE_URL=http://business-service:8001

  business-service:
    build: ./business-service
    ports:
      - "8001:8001"
    depends_on:
      - postgres
      - redis
    environment:
      - DATABASE_URL=postgresql://user:password@postgres:5432/investwin
      - REDIS_URL=redis://redis:6379

  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: investwin
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

volumes:
  postgres_data:
```

## ğŸ”§ å¼€å‘ç¯å¢ƒ

### **æœ¬åœ°å¼€å‘å¯åŠ¨é¡ºåº**
1. **å¯åŠ¨åŸºç¡€æœåŠ¡**ï¼š
   ```bash
   docker-compose up postgres redis -d
   ```

2. **å¯åŠ¨ä¸šåŠ¡æœåŠ¡**ï¼š
   ```bash
   cd business-service
   python -m venv venv
   source venv/bin/activate
   pip install -r requirements.txt
   python app/main.py  # Port: 8001
   ```

3. **å¯åŠ¨WebæœåŠ¡**ï¼š
   ```bash
   cd web-service
   source venv/bin/activate
   pip install -r requirements.txt
   python app/main.py   # Port: 8000
   ```

4. **å¯åŠ¨å‰ç«¯**ï¼š
   ```bash
   cd frontend
   npm start           # Port: 3000
   ```

## ğŸš€ å¼€å‘ä¼˜åŠ¿

### **å¾®æœåŠ¡æ¶æ„ä¼˜åŠ¿**
1. **æœåŠ¡ç‹¬ç«‹**ï¼šWebå’Œä¸šåŠ¡æœåŠ¡ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²
2. **æŠ€æœ¯çµæ´»**ï¼šä¸åŒæœåŠ¡å¯ä»¥ä½¿ç”¨ä¸åŒçš„æŠ€æœ¯æ ˆ
3. **å¯æ‰©å±•æ€§**ï¼šå¯ä»¥æ ¹æ®è´Ÿè½½ç‹¬ç«‹æ‰©å±•ç‰¹å®šæœåŠ¡
4. **å®¹é”™æ€§å¥½**ï¼šå•ä¸ªæœåŠ¡æ•…éšœä¸å½±å“æ•´ä¸ªç³»ç»Ÿ
5. **å›¢é˜Ÿåä½œ**ï¼šä¸åŒå›¢é˜Ÿå¯ä»¥å¹¶è¡Œå¼€å‘ä¸åŒæœåŠ¡

### **æŠ•èµ„å¹³å°ä¼˜åŠ¿**
6. **å‰åç«¯åˆ†ç¦»**ï¼šReactå‰ç«¯ä¸Pythonåç«¯å®Œå…¨åˆ†ç¦»
7. **å®æ—¶æ•°æ®**ï¼šWebSocketæ”¯æŒæ¯«ç§’çº§æ•°æ®æ›´æ–°
8. **æ™ºèƒ½åˆ†æ**ï¼šåŸºäºç®—æ³•çš„æœºä¼šè‡ªåŠ¨è¯†åˆ«
9. **é£é™©å¯æ§**ï¼šå¤šå±‚æ¬¡é£é™©ç›‘æ§å’Œé¢„è­¦
10. **ä¸“ä¸šåˆ†æ**ï¼šæŠ€æœ¯é¢ã€èµ„é‡‘é¢ã€è¡ç”Ÿå“å…¨è¦†ç›–

## ğŸ“š APIæ¥å£è®¾è®¡

### **Web Service API (é¢å‘å‰ç«¯)**
- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
- `GET /api/assets/` - èµ„äº§åˆ—è¡¨ç®¡ç†
- `GET /api/assets/{symbol}/analysis` - èµ„äº§åˆ†æç»“æœ
- `GET /api/opportunities/` - æŠ•èµ„æœºä¼šåˆ—è¡¨
- `GET /api/risk/portfolio` - ç»„åˆé£é™©è¯„ä¼°
- `WebSocket /ws/realtime/` - å®æ—¶æ•°æ®æ¨é€

### **Business Service API (å†…éƒ¨æœåŠ¡)**
- `GET /analysis/technical/{symbol}` - æŠ€æœ¯åˆ†æ
- `GET /analysis/fundamental/{symbol}` - åŸºæœ¬é¢åˆ†æ
- `GET /risk/assessment/{symbol}` - é£é™©è¯„ä¼°
- `GET /opportunities/scan/{symbol}` - æœºä¼šæ‰«æ
- `POST /portfolio/optimize` - ç»„åˆä¼˜åŒ–

### **åŠŸèƒ½ç‰¹ç‚¹**
- RESTful APIè®¾è®¡ï¼Œç»Ÿä¸€å“åº”æ ¼å¼
- JWTè®¤è¯ï¼Œæƒé™æ§åˆ¶
- æœåŠ¡é—´é€šä¿¡ï¼Œå¼‚æ­¥å¤„ç†
- ç¼“å­˜ç­–ç•¥ï¼Œæ€§èƒ½ä¼˜åŒ–
- è‡ªåŠ¨ç”ŸæˆAPIæ–‡æ¡£
- å®Œæ•´çš„é”™è¯¯å¤„ç†æœºåˆ¶